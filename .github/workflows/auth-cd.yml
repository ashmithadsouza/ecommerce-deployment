
name: Auth Service CD



on:

  workflow_run:

    workflows: ["Auth Service CI"]

    types: [completed]

    branches: [main]



jobs:

  deploy-to-cloud-run:

    # Only run if the CI workflow actually passed

    if: ${{ github.event.workflow_run.conclusion == 'success' }}

    runs-on: ubuntu-latest

    

    steps:

      - name: Authenticate to Google Cloud

        uses: google-github-actions/auth@v1

        with:

          credentials_json: ${{ secrets.GCP_SA_KEY }}



      - name: Set up Cloud SDK

        uses: google-github-actions/setup-gcloud@v1



      - name: Deploy to Cloud Run

        run: |

          gcloud run deploy auth-service \

            --image ghcr.io/${{ github.repository_owner }}/auth-service:latest \

            --region us-central1 \

            --platform managed \

            --allow-unauthenticated \

            --port 8081

